var CronJob = require('cron').CronJob;
var job = new CronJob('*/10 * * * * *', function() {

    var fs = require('fs');
    var Promise = require('bluebird');
    var readFile = Promise.promisify(fs.readFile);
    var writeFile = Promise.promisify(fs.writeFile);
    

    var promiseArray = [readFile('Conduit Inventory.txt'), 
                        readFile('Conduit statistics.txt'), 
                        readFile('Flow routing continuity.txt'),
                        readFile('Inflows.txt'),
                        readFile('Model complexity.txt'),
                        readFile('Model inventory.txt'),
                        readFile('Node statistics.txt'),
                        readFile('Options.txt'),
                        readFile('Pipe inventory.txt'),
                        readFile('Results statistics.txt'),
                        readFile('Runoff quantity continuity.txt'),
                        readFile('Subcatchment statistics.txt'),
                        readFile('Unused objects.txt')
                    ];

    Promise.all(promiseArray).then((dataArray)=>{
        var data = '';
        var obj ={};
        for(var i=0;i<dataArray.length;i++){
            data += dataArray[i];
            //dataArray ไม่ใช่ row แต่เป็นไฟล์
            let allfile = ""+dataArray[i];
            //eval(dataArray[i]);
            //console.log(eval(dataArray[i]));
            
            //let column = allfile.split("\t");
            let breakfile = allfile.split("\r\n");
            for(item of breakfile){
                let line = item.split("\t");
                if(line.length>=2){
                    let key = ""+line[0];
                    let value = ""+line[1];
                    obj[key] = value;              
                }
                //console.log(line);
            }
            //let file = breakfile.toString().split(",");



            //console.log(breakfile);
        }
        console.log(obj);
    //console.log(typeof(data));
    });

    /*Promise.all(promiseArray).then((dataArray)=>{
        var data = '';
        for(var i=0;i<dataArray.length;i++){
            data += dataArray[i];
            //dataArray ไม่ใช่ row แต่เป็นไฟล์
            let allfile = ""+dataArray[i];
            //eval(dataArray[i]);
            //console.log(eval(dataArray[i]));
            let column = allfile.split("\t");
            let breakfile = column.toString().split("\r\n");
            let file = breakfile.toString().split(",");
            console.log(file);
        }
    //console.log(typeof(data));
    });*/

    console.log('-----------------------------');

}, null, true, 'America/Los_Angeles');
job.start();